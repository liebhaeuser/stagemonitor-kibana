<div>

  <h3>
    Visualization for trace {{ctrl.trace._source.trace_id}} (<a target="_blank" href="../app/kibana#/discover/Request-Analysis?_g=(time:(from:now-1h,mode:quick,to:now))&_a=(filters:!((meta:(alias:!n,disabled:!f,index:'stagemonitor-spans-*',key:trace_id,negate:!f,value:'{{ctrl.trace._source.trace_id}}'),query:(match:(trace_id:(query:'{{ctrl.trace._source.trace_id}}',type:phrase))))),index:'stagemonitor-spans-*')">show all spans for this trace</a>)
    <small class="pull-right"><a onclick="event.preventDefault(); return false;" href="#/trace/{{ctrl.trace._source.trace_id}}">Permalink</a></small>
  </h3>

  <div class="trace-visualization">

    <div class="clearfix">
      <div class="pull-right">
        <button ng-click="ctrl.selectedVisualization = 'graph'">Graph</button>
        <button ng-click="ctrl.selectedVisualization = 'waterfall'">Waterfall</button>
      </div>
    </div>

    <svg ng-show="ctrl.selectedVisualization == 'graph'" id="trace-{{ctrl.trace._source.trace_id}}">
      <g></g>
    </svg>

    <div ng-show="ctrl.selectedVisualization == 'waterfall'" class="waterfall clearfix">
      <div class="waterfall--treearea">
        <div ng-repeat="span in ctrl.waterfallSpans">
          <div class="waterfall--spacing waterfall--treerow"
               ng-click="ctrl.openSpan(span)"
               ng-class="{'waterfall--treerow_active': span === ctrl.selectedSpan}"
               ng-style="{'padding-left': '{{span.indentation}}em'}">
            <i class='fa {{span.iconClass}}' aria-hidden='true' title="{{span.iconTitle}}"></i> {{span._source.name}} <small>({{span._source.application}})</small>
          </div>
        </div>
      </div>
      <div class="waterfall--grapharea">
        <div ng-repeat="span in ctrl.waterfallSpans"
             class="waterfall--bar"
             ng-style="{width: '{{span.width}}%', 'margin-left': '{{span.offset}}%'}">
          <div class="waterfall--spacing">
            {{span._source.duration_ms | number:2}} ms
          </div>
        </div>
      </div>
    </div>

  </div>

  <span-details selected-span="ctrl.selectedSpan"
                selected-span-properties="ctrl.selectedSpanProperties">
  </span-details>

</div>
