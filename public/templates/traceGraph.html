<div>

  <h3>
    Visualization for trace {{ctrl.trace._source.trace_id}} (<a target="_blank" href="../app/kibana#/discover/Request-Analysis?_g=(time:(from:now-1h,mode:quick,to:now))&_a=(filters:!((meta:(alias:!n,disabled:!f,index:'stagemonitor-spans-*',key:trace_id,negate:!f,value:'{{ctrl.trace._source.trace_id}}'),query:(match:(trace_id:(query:'{{ctrl.trace._source.trace_id}}',type:phrase))))),index:'stagemonitor-spans-*')">show all spans for this trace</a>)
    <small class="pull-right"><a onclick="event.preventDefault(); return false;" href="#/trace/{{ctrl.trace._source.trace_id}}">Permalink</a></small>
  </h3>

  <div class="trace-visualization">
    <svg id="trace-{{ctrl.trace._source.trace_id}}">
      <g></g>
    </svg>
  </div>

  <div ng-if="ctrl.selectedSpan != null">
    <h3>
      Details for span <code>{{ctrl.selectedSpan._source.name}}</code>
    </h3>

    <ul class="nav nav-tabs" role="tablist">
      <li ng-class="ctrl.openedTab === 'attributes' ? 'active' : ''" ng-click="ctrl.openedTab = 'attributes'"><a>Attributes</a></li>
      <li ng-class="ctrl.openedTab === 'calltree' ? 'active' : ''" ng-click="ctrl.openedTab = 'calltree'" ng-if="ctrl.selectedSpan._source.call_tree_ascii"><a>Call tree</a></li>
    </ul>

    <div class="doc-viewer" ng-if="ctrl.openedTab === 'attributes'">
      <table class="table table-condensed span-details">
        <tr ng-repeat="prop in ctrl.selectedSpanProperties" ng-if="prop.propName != 'call_tree_ascii'">
          <td>{{prop.propName}}</td>
          <td>
            <span>
              {{prop.value}}
            </span>
          </td>
        </tr>
      </table>
    </div>

    <div ng-if="ctrl.openedTab === 'calltree'">
      <pre class="calltree">{{ctrl.selectedSpan._source.call_tree_ascii}}</pre>
      <span class="small">Hint: press the <i class="fa fa-sitemap"></i> icon in the trace graph to open directly the call tree of the clicked span</span>
    </div>
  </div>

</div>
